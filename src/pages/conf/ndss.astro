---
import { useState, useEffect } from 'react';

const [indexData, setIndexData] = useState(null);
const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());
const [papers, setPapers] = useState([]);

useEffect(() => {
  fetch('/data/ndss/index.json')
    .then(res => res.json())
    .then(data => {
      setIndexData(data);
      if (data.years[selectedYear]) {
        loadYear(selectedYear);
      }
    });
}, []);

function loadYear(year) {
  setSelectedYear(year);
  fetch(`/data/ndss/${year}.json`)
    .then(res => res.json())
    .then(data => setPapers(data.items || []));
}
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>NDSS Papers</title>
  </head>
  <body>
    <h1>NDSS Papers</h1>

    {indexData && (
      <div>
        <label for="yearSelect">Select Year:</label>
        <select id="yearSelect" value={selectedYear} onChange={(e) => loadYear(parseInt(e.target.value))}>
          {Object.entries(indexData.years)
            .sort((a, b) => b[0] - a[0])
            .map(([year, info]) => (
              <option value={year}>{year} ({info.count})</option>
            ))}
        </select>
        <div style="font-size:0.9em;color:gray;">
          Last updated: {new Date(indexData.last_updated).toLocaleString()}
        </div>
      </div>
    )}

    <ul>
      {papers.map((paper) => (
        <li>
          <strong>{paper.title}</strong>
          <div>Authors: {paper.authors.join(', ')}</div>
          {paper.pdf_url && <a href={paper.pdf_url} target="_blank">PDF</a>}
        </li>
      ))}
    </ul>
  </body>
</html>
